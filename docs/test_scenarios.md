# 테스트 시나리오 문서

이 문서는 sim_soccer 패키지의 테스트 시나리오를 설명합니다.

## 테스트 구조

### 1. 단위 테스트 (Unit Tests)

각 모듈의 독립적인 기능을 테스트합니다.

#### 1.1 PlayerState 테스트 (`tests/unit/test_player.py`)

**목적**: 선수 상태 모델의 기본 기능 검증

**테스트 케이스**:
- 선수 생성 및 기본 속성 확인
- 잘못된 포지션 처리
- 포지션별 가중치 적용된 스탯 계산
- 체력 페널티가 적용된 유효 스탯 계산
- 체력 수준에 따른 페널티 계산
- 총 포인트 계산
- 포지션별 가중치 검증 (GK, DF, MF, FW)

**기대 결과**:
- 모든 포지션에서 가중치가 올바르게 적용됨
- 체력 페널티가 스탯에 정확히 반영됨
- 포인트 계산이 정확함

#### 1.2 TeamState 테스트 (`tests/unit/test_team.py`)

**목적**: 팀 상태 모델의 기본 기능 검증

**테스트 케이스**:
- 팀 생성 및 기본 속성 확인
- 선수 ID로 선수 찾기
- 포지션으로 선수 찾기
- 평균 스탯 계산
- 공을 가진 선수 찾기 및 설정
- 기본 전술 설정

**기대 결과**:
- 선수 검색 기능이 정확히 동작
- 통계 계산이 정확함
- 공 소유 관리가 올바르게 동작

#### 1.3 Zone 시스템 테스트 (`tests/unit/test_zone.py`)

**목적**: 필드 Zone 시스템의 기본 기능 검증

**테스트 케이스**:
- Zone 번호와 좌표 간 변환
- Zone 간 거리 계산
- Zone의 세로/가로 위치 확인
- 전방/후방/중앙 Zone 판별
- Phase별 Zone 정의

**기대 결과**:
- 모든 Zone 변환이 정확함
- 거리 계산이 올바름
- Phase별 Zone이 올바르게 정의됨

#### 1.4 체력 시스템 테스트 (`tests/unit/test_stamina.py`)

**목적**: 체력 시스템의 계산 로직 검증

**테스트 케이스**:
- 행동별 기본 체력 소모량
- 전술에 따른 체력 소모량 변화
- STA 스탯에 따른 체력 소모량 감소
- 체력 페널티 적용
- 후반 시작 시 체력 회복
- 체력에 따른 행동 빈도 배율

**기대 결과**:
- 체력 소모량이 전술과 스탯에 따라 올바르게 계산됨
- 페널티가 정확히 적용됨
- 후반 회복이 올바르게 동작

#### 1.5 전술 시스템 테스트 (`tests/unit/test_tactics.py`)

**목적**: 전술 효과 계산 로직 검증

**테스트 케이스**:
- 공격성 보정치 계산
- 패스 스타일 보정치 계산 (짧은 패스 vs 긴 패스)
- 압박 강도 보정치 계산
- 수비 라인 보정치 계산
- 전환 속도 보정치 계산
- 폭 보정치 계산
- 전술 보정치 종합 계산
- Phase 전환 확률 계산

**기대 결과**:
- 모든 전술 파라미터가 올바르게 보정치에 반영됨
- Phase 전환 확률이 전술과 스탯에 따라 올바르게 계산됨

#### 1.6 ContestResolver 테스트 (`tests/unit/test_contest_resolver.py`)

**목적**: 컨테스트 계산 및 판정 로직 검증

**테스트 케이스**:
- 패스 컨테스트 점수 계산
- 슈팅 컨테스트 점수 계산
- 컨테스트 판정 (성공/실패)
- 성공 확률 범위 검증 (20%-80%)

**기대 결과**:
- 컨테스트 점수가 스탯, 전술, 상황에 따라 올바르게 계산됨
- 성공 확률이 올바른 범위 내에 있음
- 판정이 확률에 따라 올바르게 동작

### 2. 통합 테스트 (Integration Tests)

전체 시스템의 통합 동작을 테스트합니다.

#### 2.1 경기 시뮬레이션 통합 테스트 (`tests/integration/test_match_simulation.py`)

**목적**: 전체 경기 시뮬레이션 플로우 검증

**테스트 케이스**:
- 기본 경기 시뮬레이션 실행
- 시뮬레이션 재현성 (같은 시드로 같은 결과)
- JSON 파일을 사용한 경기 시뮬레이션
- 경기 이벤트 로그 생성
- 경기 통계 기록
- 체력 시스템 통합 동작

**기대 결과**:
- 경기가 정상적으로 완료됨 (90분 진행)
- 같은 시드로 실행 시 동일한 결과
- 모든 이벤트와 통계가 올바르게 기록됨
- 체력 시스템이 경기 중 올바르게 동작

#### 2.2 팀 로더 통합 테스트 (`tests/integration/test_team_loader.py`)

**목적**: 팀 데이터 로드 및 검증 기능 검증

**테스트 케이스**:
- 유효한 팀 데이터 로드
- 잘못된 선수 수 처리
- 잘못된 포인트 합계 처리
- 잘못된 포지션 구성 처리
- 잘못된 스탯 범위 처리
- 잘못된 전술 범위 처리
- 전술 기본값 설정

**기대 결과**:
- 유효한 데이터는 정상적으로 로드됨
- 잘못된 데이터는 적절한 오류 발생
- 검증이 정확하게 동작

### 3. 시나리오 테스트 (Scenario Tests)

실제 게임 상황을 시뮬레이션하는 테스트입니다.

#### 3.1 공격팀 vs 수비팀 시나리오 (`tests/scenarios/test_attack_vs_defense.py`)

**목적**: 공격적 전술과 수비적 전술의 차이 검증

**시나리오 설명**:
- 공격팀: 높은 공격성(9), 긴 패스(8), 높은 압박(8), 상향 수비 라인(7), 빠른 전환(9)
- 수비팀: 낮은 공격성(3), 짧은 패스(2), 낮은 압박(3), 하향 수비 라인(2), 느린 전환(3)

**테스트 케이스**:
- 공격팀이 더 많은 슈팅 시도
- 수비팀이 더 많은 태클 시도
- 여러 번 실행하여 패턴 확인

**기대 결과**:
- 공격팀이 평균적으로 더 많은 슈팅과 골을 기록
- 수비팀이 더 많은 태클과 인터셉트를 시도
- 전술 차이가 경기 결과에 반영됨

#### 3.2 균형형 팀 vs 특화형 팀 시나리오 (`tests/scenarios/test_balanced_vs_specialized.py`)

**목적**: 균형형 스탯 분배와 특화형 스탯 분배의 차이 검증

**시나리오 설명**:
- 균형형 팀: 모든 선수에게 평균적으로 포인트 분배 (각 선수 약 9 포인트)
- 특화형 팀: 핵심 선수(공격수, 플레이메이커)에 포인트 집중 (공격수 2명에 각 40 포인트, 나머지 최소)

**테스트 케이스**:
- 특화형 팀의 공격수가 높은 슈팅 스탯 보유
- 균형형 팀의 선수들이 비슷한 수준의 스탯 보유
- 통계 비교

**기대 결과**:
- 특화형 팀의 공격수가 더 높은 슈팅 능력을 보유
- 균형형 팀은 더 균형잡힌 통계를 기록
- 두 전략 모두 유효함

#### 3.3 극단적 전술 조합 시나리오 (`tests/scenarios/test_extreme_tactics.py`)

**목적**: 극단적 전술 조합의 효과 검증

**시나리오 설명**:
1. **극단적 공격 vs 극단적 수비**
   - 공격팀: 모든 전술 최대값(10)
   - 수비팀: 모든 전술 최소값(1)

2. **짧은 패스 vs 긴 패스**
   - 짧은 패스 팀: 패스 스타일 1
   - 긴 패스 팀: 패스 스타일 10

3. **높은 압박 vs 낮은 압박**
   - 높은 압박 팀: 압박 강도 10
   - 낮은 압박 팀: 압박 강도 1

**테스트 케이스**:
- 극단적 공격 팀의 슈팅 수와 체력 소모
- 짧은 패스 팀의 패스 성공률
- 높은 압박 팀의 태클 수와 체력 소모

**기대 결과**:
- 극단적 전술이 경기 통계에 명확히 반영됨
- 각 전술의 리스크/리워드가 올바르게 구현됨
- 극단적 전술의 트레이드오프가 드러남

## 테스트 실행 방법

### 전체 테스트 실행

```bash
pytest
```

### 특정 카테고리 테스트 실행

```bash
# 단위 테스트만
pytest tests/unit/

# 통합 테스트만
pytest tests/integration/

# 시나리오 테스트만
pytest tests/scenarios/
```

### 특정 테스트 파일 실행

```bash
pytest tests/unit/test_player.py
```

### 커버리지 포함 실행

```bash
pytest --cov=sim_soccer --cov-report=term-missing
```

## 테스트 원칙

1. **독립성**: 각 테스트는 독립적으로 실행 가능해야 함
2. **재현성**: 랜덤 시드를 사용하여 재현 가능한 테스트
3. **명확성**: 테스트 이름과 주석으로 의도가 명확해야 함
4. **완전성**: 주요 기능과 엣지 케이스를 모두 커버
5. **실용성**: 실제 게임 상황을 반영한 시나리오 테스트

## 향후 개선 사항

1. **성능 테스트**: 대량의 경기 시뮬레이션 성능 측정
2. **밸런스 테스트**: 다양한 전술 조합의 승률 분석
3. **엣지 케이스 테스트**: 극단적인 스탯 분배와 전술 조합
4. **회귀 테스트**: 버그 수정 후 재발 방지
5. **통계 검증**: 시뮬레이션 결과의 통계적 유효성 검증
