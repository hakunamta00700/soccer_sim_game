# Football Manager 스타일 PvP 축구 시뮬레이션 게임 설계 문서

## 목차

1. [PRD (Product Requirements Document)](#1-prd-product-requirements-document)
2. [선수 스탯 시스템 설계](#2-선수-스탯-시스템-설계)
3. [팀 전술 시스템 설계](#3-팀-전술-시스템-설계)
4. [경기 시뮬레이션 엔진 설계](#4-경기-시뮬레이션-엔진-설계)
5. [컨테스트(행동 판정) 계산 구조](#5-컨테스트행동-판정-계산-구조)
6. [공간/필드 모델](#6-공간필드-모델)
7. [체력·모멘텀·후반 변화 설계](#7-체력모멘텀후반-변화-설계)
8. [경기 결과 및 리포트 시스템](#8-경기-결과-및-리포트-시스템)
9. [데이터 구조 예시](#9-데이터-구조-예시)
10. [MVP 범위 정의](#10-mvp-범위-정의)

---

## 1. PRD (Product Requirements Document)

### 1.1 게임 핵심 목표

#### 플레이 경험 목표

이 게임은 **"전술적 사고와 스탯 배분의 균형을 통한 경쟁적 축구 시뮬레이션"**을 제공합니다.

**핵심 플레이 경험:**

1. **팀 빌딩의 자유도**
   - 100 포인트를 11명의 선수에게 자유롭게 분배
   - 균형형 팀 vs 특화형 팀의 전략적 선택
   - 포지션별 최적화 vs 전체적 균형의 트레이드오프

2. **전술적 깊이**
   - 각 전술 선택이 경기 결과에 직접적이고 설명 가능한 영향을 미침
   - 상대 전술에 대한 대응 전략 수립
   - 실시간 관전 중 전술 변경을 통한 적응형 플레이

3. **결과의 설명 가능성**
   - 모든 골, 기회, 실수가 스탯과 전술 조합으로 설명됨
   - "왜 이겼는지/왜 졌는지"가 명확히 드러남
   - 경기 리포트를 통한 학습과 개선

4. **PvP 경쟁의 공정성**
   - 실존 선수 데이터 없이 모든 유저가 동일한 조건에서 시작
   - 스탯 분배와 전술 선택만이 승부를 결정
   - 랜덤 요소는 컨테스트 점수 기반 확률로 제한되어 공정성 유지

#### 유저가 매 경기에서 고민하게 되는 것

- **경기 전:**
  - 상대의 전술 추측 및 대응 전략 수립
  - 현재 메타에 맞는 스탯 분배 전략 선택
  - 리스크/리워드가 있는 전술 선택 (공격적 전술 = 기회 증가 but 수비 취약)

- **경기 중 (실시간 관전):**
  - 전반 전개 양상 분석 및 후반 전술 조정
  - 상대의 약점 발견 및 전술 변경
  - 체력 소모와 모멘텀 변화에 따른 타이밍 판단

- **경기 후:**
  - 경기 리포트 분석을 통한 전술/스탯 조정
  - 승리/패배 원인 파악 및 다음 경기 전략 수립

### 1.2 핵심 차별점

#### 실존 데이터 없는 환경에서도 축구 같은 느낌이 나는 이유

1. **도메인 기반 스탯 설계**
   - 축구의 실제 행동(패스, 드리블, 슈팅, 태클 등)을 직접적으로 반영하는 스탯
   - "골 결정력" 같은 결과 스탯 대신 "슈팅 정확도", "공간 감각" 같은 행동 스탯 사용
   - 스탯 간 상호작용이 축구의 실제 메커니즘을 모방

2. **Phase 기반 시뮬레이션**
   - 빌드업 → 중원 전개 → 파이널 서드의 실제 축구 흐름을 시뮬레이션
   - 각 Phase에서 발생하는 컨테스트가 축구의 실제 상황과 유사
   - 전환(Transition) Phase를 통한 공수 전환의 긴장감 구현

3. **Zone 기반 공간 모델**
   - 실제 좌표 대신 축구장을 Zone으로 분할하여 공간 개념 구현
   - 선수 배치와 볼 위치가 전술적 의미를 가짐
   - "공간 창출", "압박" 같은 축구 개념을 Zone 레벨에서 구현

4. **확률 기반이지만 설명 가능한 결과**
   - 모든 랜덤 요소가 스탯 차이를 기반으로 한 확률
   - 높은 스탯 = 높은 성공률이지만 완벽하지 않음 (축구의 불확실성)
   - 결과가 항상 "스탯 A가 높아서 성공" 또는 "스탯 B가 낮아서 실패"로 설명 가능

#### PvP 전용 구조의 장점과 설계 포인트

**장점:**

1. **공정한 경쟁 환경**
   - 모든 유저가 동일한 100 포인트 제약
   - 실존 선수 데이터로 인한 불균형 없음
   - 순수한 전술과 스탯 배분 능력의 경쟁

2. **빠른 매칭과 경기 진행**
   - AI 팀과의 경기 없이 유저 간 직접 대전
   - 실시간 관전 가능 (5-10분 경기)
   - 즉시 결과 확인 및 다음 경기 준비

3. **메타 진화와 밸런스**
   - 유저들의 전술 실험을 통한 자연스러운 메타 진화
   - 특정 전술이 지배적이 되면 대응 전술 개발 유도
   - 개발자가 밸런스 패치를 통해 건강한 메타 유지 가능

**설계 포인트:**

1. **단일 전술의 지배 방지**
   - 각 전술이 명확한 리스크/리워드 구조를 가짐
   - 전술 간 상호작용을 통한 카운터 메커니즘 구현
   - 랜덤 요소를 통한 완벽한 예측 불가능성 유지

2. **스탯 분배의 다양성 보장**
   - 균형형(평균 9.09 포인트) vs 특화형(일부 선수 집중 투자) 모두 유효
   - 포지션별 최적 스탯 분배가 다르도록 설계
   - 특정 스탯에만 투자하는 전략이 항상 최선이 아니도록 밸런스

3. **학습 곡선 관리**
   - 초보자도 기본 전술로 경쟁 가능
   - 고수는 세밀한 전술 조정과 스탯 최적화로 우위 확보
   - 경기 리포트를 통한 학습 지원

### 1.3 핵심 게임 루프

#### 전체 게임 플로우

```
[팀 생성] → [스탯 분배] → [전술 설정] → [매칭] → [경기 시뮬레이션] → [결과 분석] → [개선] → [다음 경기]
```

#### 각 단계별 상세 설명

**1. 팀 생성**
- 유저는 11명의 선수로 구성된 팀을 생성
- 각 선수는 포지션 할당 (GK, DF, MF, FW)
- 기본 포지션 구성: 1-4-4-2, 1-4-3-3, 1-3-5-2 등 선택 가능

**2. 스탯 분배**
- 총 100 포인트를 11명의 선수에게 분배
- 각 선수의 스탯 합계 = 해당 선수에게 할당된 포인트
- 최소 포인트: 선수당 1 포인트 (총 11 포인트)
- 최대 포인트: 제한 없음 (나머지 선수는 최소값)
- 스탯 분배는 경기 전에만 변경 가능 (경기 중 변경 불가)

**3. 전술 설정**
- 5-7개의 전술 파라미터를 설정
- 각 파라미터는 명확한 값 범위와 영향력을 가짐
- 전술은 경기 전에 설정하거나, 실시간 관전 중 변경 가능 (제한적)
- 전술 변경 시 즉시 반영 (다음 Phase부터 적용)

**4. 매칭**
- 유저는 매칭 큐에 진입
- 유사한 레벨/랭크의 유저와 매칭 (초기에는 랜덤 매칭)
- 매칭 성공 시 즉시 경기 시작

**5. 경기 시뮬레이션**
- Tick 기반 시뮬레이션 실행
- 실시간 관전 가능 (5-10분 소요)
- 각 Tick에서 Phase 판정, 행동 선택, 컨테스트 계산, 상태 업데이트
- 주요 이벤트(골, 기회, 실수 등)가 발생하면 즉시 표시

**6. 결과 분석**
- 경기 종료 후 상세 리포트 제공
- 골 장면, 주요 기회, 전술 효과 분석
- "왜 이겼는지/왜 졌는지"를 스탯과 전술로 설명
- 양팀의 스탯 비교, 전술 비교, Phase별 성공률 등 제공

**7. 개선 및 다음 경기**
- 리포트 분석을 바탕으로 스탯 분배 조정
- 전술 변경 또는 새로운 전술 실험
- 다음 경기 준비

#### 유저 선택이 영향을 주는 지점

| 선택 단계 | 영향받는 경기 요소 | 영향 방식 |
|---------|------------------|---------|
| 스탯 분배 | 모든 컨테스트 | 선수 스탯이 컨테스트 점수에 직접 사용됨 |
| 전술 설정 | Phase 전환 확률, 행동 선택 확률, 보정치 | 전술이 Phase 전환과 행동 성공률에 보정치 적용 |
| 포지션 구성 | 포지션별 스탯 가중치 | 같은 스탯이라도 포지션에 따라 효과가 다름 |
| 실시간 전술 변경 | 현재 진행 중인 Phase 이후 | 다음 Phase부터 새로운 전술 적용 |

---

## 2. 선수 스탯 시스템 설계

### 2.1 스탯 설계 원칙

#### 스탯 수 제한 이유

1. **명확성과 이해도**
   - 스탯이 너무 많으면 유저가 각 스탯의 의미를 파악하기 어려움
   - 6-8개 스탯이면 충분히 다양한 전략을 만들 수 있으면서도 이해 가능

2. **밸런스 복잡도 관리**
   - 스탯 간 상호작용이 많아질수록 밸런스 조정이 어려워짐
   - 각 스탯이 명확한 역할을 가지도록 제한

3. **구현 복잡도**
   - 스탯이 많을수록 컨테스트 계산식이 복잡해짐
   - 6-8개 스탯으로도 충분히 다양한 컨테스트를 설계 가능

#### "결과 스탯"을 배제해야 하는 이유

**결과 스탯의 문제점:**

- "골 결정력", "어시스트 능력" 같은 스탯은 결과를 직접적으로 나타냄
- 이러한 스탯은 경기 시뮬레이션에서 순환 참조 문제를 일으킴
- 예: "골 결정력이 높으면 골을 넣는다" → 하지만 골을 넣는 것이 골 결정력의 정의

**행동 스탯의 장점:**

- "슈팅 정확도", "패스 정확도" 같은 스탯은 행동의 품질을 나타냄
- 이러한 스탯은 컨테스트에서 사용되어 결과를 만들어냄
- 결과는 행동 스탯의 조합으로 자연스럽게 발생

**예시:**

- ❌ "골 결정력 10" → 골 확률 +20%
- ✅ "슈팅 정확도 8, 공간 감각 7" → 슈팅 컨테스트에서 높은 점수 → 골 확률 증가

### 2.2 최종 스탯 목록 (7개)

#### 스탯 정의 및 사용처

| 스탯명 | 약어 | 의미 | 사용 컨테스트 | 전술 결합 방식 |
|-------|------|------|--------------|---------------|
| **패스 정확도** | PAS | 패스를 정확하게 전달하는 능력 | 패스 성공, 빌드업 Phase | 짧은 패스 전술: 가중치 증가 |
| **드리블 능력** | DRI | 공을 잃지 않고 상대를 제친 능력 | 드리블 성공, 압박 회피 | 공격적 전술: 사용 빈도 증가 |
| **슈팅 정확도** | SHO | 골대를 향해 정확하게 슈팅하는 능력 | 슈팅 정확도 판정, 골 확률 | 공격적 전술: 기회 증가 |
| **공간 감각** | SPA | 적절한 위치로 이동하고 공간을 활용하는 능력 | 포지셔닝, 오프더볼 움직임 | 전술과 무관 (항상 중요) |
| **태클 능력** | TAC | 상대의 공을 빼앗는 능력 | 태클 성공, 수비 컨테스트 | 수비적 전술: 가중치 증가 |
| **인터셉트 능력** | INT | 패스를 차단하고 예측하는 능력 | 인터셉트 성공, 패스 차단 | 압박 전술: 사용 빈도 증가 |
| **체력** | STA | 지속적인 활동 능력과 회복력 | 체력 소모, 후반 페널티 | 전술과 무관 (항상 중요) |

#### 각 스탯의 상세 설명

**1. 패스 정확도 (PAS)**

- **의미:** 선수가 패스를 정확하게 전달하는 능력
- **사용 컨테스트:**
  - 빌드업 Phase: 후방에서 중원으로의 패스
  - 중원 전개 Phase: 중원 내 패스, 사이드 전개
  - 파이널 서드 Phase: 최종 패스, 크로스
- **전술 결합:**
  - 짧은 패스 전술: PAS 스탯의 가중치 1.2배
  - 긴 패스 전술: PAS 스탯의 가중치 0.8배 (거리 페널티)
  - 빠른 전환 전술: PAS 스탯의 가중치 1.1배 (빠른 판단 보너스)

**2. 드리블 능력 (DRI)**

- **의미:** 공을 잃지 않고 상대를 제치거나 압박을 회피하는 능력
- **사용 컨테스트:**
  - 압박 상황에서의 탈출
  - 1대1 드리블 성공
  - 공간 창출을 위한 드리블
- **전술 결합:**
  - 공격적 전술: DRI 사용 빈도 +30%
  - 수비적 전술: DRI 사용 빈도 -20%
  - 개인 기술 중심 전술: DRI 스탯의 가중치 1.3배

**3. 슈팅 정확도 (SHO)**

- **의미:** 골대를 향해 정확하게 슈팅하는 능력 (파워나 골 결정력이 아님)
- **사용 컨테스트:**
  - 슈팅 정확도 판정 (골대 안/밖)
  - 골 확률 계산 (정확도가 높을수록 골 확률 증가)
  - 파이널 서드 Phase의 슈팅 기회
- **전술 결합:**
  - 공격적 전술: 슈팅 기회 빈도 +25%
  - 신중한 슈팅 전술: SHO 스탯의 가중치 1.2배 (기회는 적지만 정확도 증가)
  - 빠른 슈팅 전술: SHO 스탯의 가중치 0.9배 (기회는 많지만 정확도 감소)

**4. 공간 감각 (SPA)**

- **의미:** 적절한 위치로 이동하고 공간을 활용하는 능력 (오프더볼 움직임)
- **사용 컨테스트:**
  - 포지셔닝 판정 (수비 시 적절한 위치, 공격 시 공간 창출)
  - 오프더볼 움직임 성공
  - Zone 간 이동 시 공간 활용
- **전술 결합:**
  - 전술과 무관하게 항상 중요 (모든 Phase에서 사용)
  - 넓은 공간 활용 전술: SPA 스탯의 가중치 1.15배
  - 좁은 공간 활용 전술: SPA 스탯의 가중치 0.95배

**5. 태클 능력 (TAC)**

- **의미:** 상대의 공을 직접적으로 빼앗는 능력
- **사용 컨테스트:**
  - 1대1 수비 상황에서의 태클
  - 드리블 중인 상대를 막는 태클
  - 수비 Phase의 주요 컨테스트
- **전술 결합:**
  - 수비적 전술: TAC 사용 빈도 +40%
  - 공격적 전술: TAC 사용 빈도 -30%
  - 적극적 수비 전술: TAC 스탯의 가중치 1.25배

**6. 인터셉트 능력 (INT)**

- **의미:** 패스를 차단하고 상대의 의도를 예측하는 능력
- **사용 컨테스트:**
  - 패스 차단
  - 전환 Phase에서의 인터셉트
  - 예측 수비
- **전술 결합:**
  - 압박 전술: INT 사용 빈도 +35%
  - 수비 라인 하향 전술: INT 스탯의 가중치 1.1배 (후방에서 예측)
  - 수비 라인 상향 전술: INT 스탯의 가중치 0.9배 (전방에서 예측 어려움)

**7. 체력 (STA)**

- **의미:** 지속적인 활동 능력과 회복력
- **사용 컨테스트:**
  - 체력 소모 계산 (모든 행동에서 소모)
  - 후반 체력 페널티 적용
  - 모멘텀 계산에 영향
- **전술 결합:**
  - 전술과 무관하게 항상 중요
  - 고강도 압박 전술: STA 소모량 +20%
  - 보수적 전술: STA 소모량 -15%

### 2.3 포지션/역할 처리 방식

#### 가중치 기반 포지션 시스템

스탯을 늘리지 않고 **가중치(Weight)**를 통해 포지션별 역할을 구분합니다.

**설계 원칙:**

1. 모든 선수가 동일한 7개 스탯을 가짐
2. 포지션에 따라 각 스탯의 **효과 가중치**가 다름
3. 가중치는 컨테스트 계산 시 스탯 값에 곱해짐

#### 포지션별 스탯 가중치 테이블

| 포지션 | PAS | DRI | SHO | SPA | TAC | INT | STA |
|--------|-----|-----|-----|-----|-----|-----|-----|
| **GK (골키퍼)** | 0.3 | 0.2 | 0.1 | 1.2 | 1.5 | 1.3 | 1.1 |
| **DF (수비수)** | 0.8 | 0.6 | 0.3 | 1.3 | 1.5 | 1.4 | 1.0 |
| **MF (미드필더)** | 1.2 | 1.1 | 0.7 | 1.1 | 1.0 | 1.1 | 1.1 |
| **FW (공격수)** | 0.9 | 1.3 | 1.5 | 1.2 | 0.4 | 0.6 | 1.0 |

**가중치 적용 예시:**

- MF 선수의 PAS 스탯이 8이고, 패스 컨테스트가 발생
- MF의 PAS 가중치 = 1.2
- 실제 사용되는 스탯 값 = 8 × 1.2 = 9.6

**설계 의도:**

- **GK:** TAC, INT가 매우 중요 (수비 능력), PAS는 거의 사용 안 함
- **DF:** TAC, INT가 중요 (수비), SPA도 중요 (포지셔닝)
- **MF:** PAS, DRI가 중요 (빌드업과 전개), 균형형
- **FW:** SHO, DRI가 중요 (공격), TAC는 거의 사용 안 함

#### 역할 세분화 (선택 사항)

기본 포지션 외에 **역할(Role)**을 추가하여 더 세밀한 가중치 적용 가능:

| 역할 | 설명 | 가중치 변경 예시 |
|------|------|----------------|
| **플레이메이커 (MF)** | 창의적 패스 중심 | PAS +0.2, DRI +0.1 |
| **볼윈 (MF)** | 수비형 미드필더 | TAC +0.2, INT +0.2 |
| **윙어 (FW)** | 사이드 공격 | DRI +0.2, SPA +0.1 |
| **타겟맨 (FW)** | 공중볼 및 포스트 플레이 | SHO +0.2, SPA +0.1 |

역할은 MVP 이후 확장 기능으로 고려.

---

## 3. 팀 전술 시스템 설계

### 3.1 필수 전술 파라미터 (6개)

#### 전술 파라미터 목록

| 파라미터명 | 값 범위 | 기본값 | 설명 |
|-----------|--------|--------|------|
| **공격성 (Attack)** | 1-10 | 5 | 공격적 행동 빈도와 리스크 감수 정도 |
| **패스 스타일 (Pass Style)** | 1-10 | 5 | 1=짧은 패스, 10=긴 패스 |
| **압박 강도 (Pressing)** | 1-10 | 5 | 상대 진영에서의 압박 강도 |
| **수비 라인 (Defense Line)** | 1-10 | 5 | 1=하향, 10=상향 |
| **전환 속도 (Transition Speed)** | 1-10 | 5 | 공수 전환 시 속도 |
| **폭 (Width)** | 1-10 | 5 | 공격 시 폭 활용 정도 |

#### 각 전술 파라미터 상세

**1. 공격성 (Attack)**

- **값 범위:** 1 (수비적) ~ 10 (공격적)
- **기본값:** 5
- **경기 내 영향:**
  - 공격 Phase 진입 확률: `기본 확률 × (1 + (Attack - 5) × 0.1)`
  - 슈팅 기회 빈도: `기본 빈도 × (1 + (Attack - 5) × 0.15)`
  - 드리블 시도 빈도: `기본 빈도 × (1 + (Attack - 5) × 0.2)`
  - 수비 인원 감소: `기본 인원 - (Attack - 5) × 0.3` (최소 3명)
- **리스크/리워드:**
  - 공격적 (8-10): 기회 증가 but 수비 취약 → 실점 위험 증가
  - 수비적 (1-3): 실점 위험 감소 but 기회 감소 → 득점 어려움

**2. 패스 스타일 (Pass Style)**

- **값 범위:** 1 (짧은 패스) ~ 10 (긴 패스)
- **기본값:** 5
- **경기 내 영향:**
  - 짧은 패스 (1-3):
    - PAS 스탯 가중치: `1.0 + (4 - PassStyle) × 0.05` (최대 1.15)
    - 패스 성공률 보너스: `+ (4 - PassStyle) × 2%`
    - 빌드업 속도: 느림 (안정적)
  - 긴 패스 (7-10):
    - PAS 스탯 가중치: `1.0 - (PassStyle - 6) × 0.03` (최소 0.88)
    - 패스 거리 페널티: `- (PassStyle - 6) × 3%`
    - 빌드업 속도: 빠름 (리스크 있음)
- **리스크/리워드:**
  - 짧은 패스: 안정적 but 느림 → 상대 수비 정비 시간 제공
  - 긴 패스: 빠름 but 불안정 → 실패 시 전환 기회 제공

**3. 압박 강도 (Pressing)**

- **값 범위:** 1 (낮음) ~ 10 (높음)
- **기본값:** 5
- **경기 내 영향:**
  - 상대 패스 성공률 페널티: `- (Pressing - 5) × 2%`
  - 인터셉트 기회 증가: `기본 확률 × (1 + (Pressing - 5) × 0.25)`
  - INT 스탯 가중치: `1.0 + (Pressing - 5) × 0.04` (최대 1.2, 최소 0.84)
  - 체력 소모 증가: `기본 소모량 × (1 + (Pressing - 5) × 0.15)`
- **리스크/리워드:**
  - 높은 압박 (8-10): 상대 실수 유도 but 체력 소모 → 후반 약화
  - 낮은 압박 (1-3): 체력 절약 but 상대 여유 → 기회 제공

**4. 수비 라인 (Defense Line)**

- **값 범위:** 1 (하향) ~ 10 (상향)
- **기본값:** 5
- **경기 내 영향:**
  - 하향 (1-3):
    - 상대 파이널 서드 진입 어려움: `기본 확률 × (1 - (4 - DefenseLine) × 0.1)`
    - 오프사이드 트랩 효과: `+ (4 - DefenseLine) × 3%`
    - 공격 전개 공간 부족: `- (4 - DefenseLine) × 5%`
  - 상향 (7-10):
    - 공격 전개 공간 증가: `+ (DefenseLine - 6) × 5%`
    - 오프사이드 트랩 가능: `+ (DefenseLine - 6) × 2%`
    - 상대 파이널 서드 진입 용이: `기본 확률 × (1 + (DefenseLine - 6) × 0.1)`
- **리스크/리워드:**
  - 하향: 수비 안정 but 공격 공간 부족
  - 상향: 공격 공간 증가 but 수비 취약

**5. 전환 속도 (Transition Speed)**

- **값 범위:** 1 (느림) ~ 10 (빠름)
- **기본값:** 5
- **경기 내 영향:**
  - 공수 전환 시 기회 창출: `기본 확률 × (1 + (TransitionSpeed - 5) × 0.2)`
  - 전환 Phase에서 행동 선택 확률:
    - 빠른 전환 (7-10): 즉시 공격 시도 확률 증가
    - 느린 전환 (1-3): 안정적 재배치 확률 증가
  - PAS 스탯 가중치 (전환 시): `1.0 + (TransitionSpeed - 5) × 0.02`
- **리스크/리워드:**
  - 빠른 전환: 기회 증가 but 실수 위험
  - 느린 전환: 안정적 but 기회 감소

**6. 폭 (Width)**

- **값 범위:** 1 (좁음) ~ 10 (넓음)
- **기본값:** 5
- **경기 내 영향:**
  - 공격 시 사이드 활용: `기본 확률 × (1 + (Width - 5) × 0.15)`
  - SPA 스탯 가중치 (공격 시): `1.0 + (Width - 5) × 0.03`
  - 중앙 집중도: `1 - (Width - 5) × 0.1` (최소 0.5)
- **리스크/리워드:**
  - 넓은 폭: 사이드 활용 but 중앙 약화
  - 좁은 폭: 중앙 집중 but 상대 수비 집중 용이

### 3.2 전술 간 상호작용

#### 전술 조합의 시너지와 리스크

**강력한 조합 예시:**

1. **공격성 9 + 전환 속도 9 + 압박 강도 8**
   - 시너지: 빠른 전환과 높은 압박으로 기회 창출 극대화
   - 리스크: 체력 소모 극대화, 수비 취약
   - 카운터: 수비 라인 하향 + 낮은 압박으로 안정적 수비

2. **짧은 패스 2 + 수비 라인 하향 2 + 낮은 압박 2**
   - 시너지: 안정적 빌드업과 수비
   - 리스크: 공격 기회 부족, 상대 압박에 취약
   - 카운터: 높은 압박 + 긴 패스로 빠른 전환

3. **넓은 폭 9 + 긴 패스 8 + 공격성 7**
   - 시너지: 사이드 활용과 빠른 전개
   - 리스크: 중앙 약화, 패스 실패 시 전환
   - 카운터: 좁은 폭 + 중앙 집중 수비

#### 메타 단일화 방지 설계

**1. 랜덤 요소의 적절한 활용**
- 모든 컨테스트에 확률 요소 포함
- 높은 스탯/전술이라도 100% 성공하지 않음
- 약한 팀도 운으로 승리 가능 (하지만 확률은 낮음)

**2. 명확한 카운터 메커니즘**
- 각 전술 조합에 대한 명확한 카운터 존재
- 예: 공격적 전술 → 수비적 전술로 카운터 가능
- 유저가 상대 전술을 파악하고 대응 가능

**3. 리스크/리워드 균형**
- 강력한 조합일수록 명확한 리스크 존재
- 예: 높은 압박 = 체력 소모 = 후반 약화
- 단일 전술이 모든 상황에서 최선이 되지 않도록 설계

**4. Phase별 전술 효과 차이**
- 같은 전술이라도 Phase에 따라 효과가 다름
- 예: 높은 압박은 빌드업 Phase에서 효과적, 파이널 서드에서는 덜 효과적
- 유저가 Phase별로 전술을 조정할 동기 제공

---

## 4. 경기 시뮬레이션 엔진 설계

### 4.1 전체 구조

#### Tick 기반 시뮬레이션 개요

경기는 **Tick** 단위로 진행됩니다.

- **1 Tick = 1초 (실제 시간)**
- **경기 시간 = 90분 = 5400 Tick**
- **시뮬레이션 시간 = 5-10분 (실제 시간)**
- **Tick 속도 = 5400 Tick / (5-10분) = 약 9-18 Tick/초**

각 Tick에서 다음이 순차적으로 실행됩니다:

1. Phase 판정 (현재 Phase 유지 또는 전환)
2. 행동 선택 (현재 Phase에서 가능한 행동 중 선택)
3. 대상 선정 (행동의 주체와 대상 선수 결정)
4. 컨테스트 계산 (스탯, 전술, 상황 변수 기반)
5. 성공/실패 판정 (확률 기반)
6. 상태 업데이트 (볼 위치, 선수 위치, 체력 등)
7. 이벤트 로그 기록 (중요 이벤트만)

#### 경기 시간 처리 방식

**실제 경기 시간 vs 시뮬레이션 시간:**

- 실제 경기: 90분 (전반 45분 + 후반 45분)
- 시뮬레이션 시간: 5-10분 (유저 관전 시간)
- 시간 압축: 약 9-18배 빠르게 진행

**시간 압축 구현:**

- 모든 Tick을 빠르게 실행하되, 중요한 이벤트만 표시
- 골, 주요 기회, 전환 등만 유저에게 표시
- 나머지 Tick은 백그라운드에서 빠르게 처리

#### Phase(State Machine) 구조

경기는 **Phase**로 구분되며, Phase 간 전환이 발생합니다.

**Phase 전환 조건:**

- 각 Phase는 특정 조건에서 다른 Phase로 전환 가능
- 전환 확률은 전술과 스탯에 의해 결정됨
- 예: 빌드업 Phase → 중원 전개 Phase (패스 성공 시)

**Phase 상태 머신:**

```
[빌드업] ←→ [중원 전개] ←→ [파이널 서드]
    ↓           ↓              ↓
[전환 (공격→수비)] ←→ [전환 (수비→공격)]
    ↓
[세트피스] (선택적)
```

### 4.2 Phase 정의

#### Phase 목록 및 설명

**1. 빌드업 (Build-up) Phase**

- **의미:** 후방에서 공을 안전하게 전개하는 Phase
- **발생 조건:**
  - 골키퍼가 공을 받았을 때
  - 수비에서 공을 회수했을 때
  - 전환 Phase에서 안정적 재배치 선택 시
- **가능한 행동:**
  - 후방 패스 (DF → DF)
  - 골키퍼 롱킥
  - 사이드 전개 (DF → MF)
  - 중앙 전개 (DF → MF)
- **전환 조건:**
  - 중원으로의 패스 성공 → 중원 전개 Phase
  - 패스 실패 → 전환 Phase (공격→수비)
  - 롱킥 성공 → 중원 전개 또는 파이널 서드 Phase
- **전술 영향:**
  - 짧은 패스 전술: 빌드업 Phase 지속 시간 증가
  - 긴 패스 전술: 빠른 전환 but 실패 위험 증가

**2. 중원 전개 (Midfield Development) Phase**

- **의미:** 중원에서 공을 전개하고 기회를 만드는 Phase
- **발생 조건:**
  - 빌드업 Phase에서 중원으로 패스 성공
  - 전환 Phase에서 중원으로 전개 선택
- **가능한 행동:**
  - 중원 패스 (MF → MF)
  - 사이드 전개 (MF → 사이드)
  - 전방 패스 (MF → FW)
  - 드리블 돌파
  - 중거리 슈팅 (선택적)
- **전환 조건:**
  - 전방 패스 성공 → 파이널 서드 Phase
  - 패스 실패 → 전환 Phase
  - 드리블 성공 → 파이널 서드 Phase 또는 계속 중원 전개
- **전술 영향:**
  - 공격성: 파이널 서드 진입 확률 증가
  - 폭: 사이드 전개 빈도 증가

**3. 파이널 서드 (Final Third) Phase**

- **의미:** 상대 진영에서 골을 노리는 Phase
- **발생 조건:**
  - 중원 전개 Phase에서 전방 패스 성공
  - 드리블로 상대 진영 진입
  - 전환 Phase에서 빠른 공격 선택
- **가능한 행동:**
  - 최종 패스 (FW → FW)
  - 크로스
  - 슈팅
  - 드리블 돌파
- **전환 조건:**
  - 슈팅 → 골 또는 골킥 (전환 Phase)
  - 패스 실패 → 전환 Phase
  - 크로스 실패 → 전환 Phase
- **전술 영향:**
  - 공격성: 슈팅 빈도 증가
  - 폭: 크로스 빈도 증가

**4. 전환 (Transition) Phase**

- **의미:** 공수 전환이 발생하는 Phase
- **발생 조건:**
  - 공격 Phase에서 행동 실패
  - 수비 Phase에서 공 회수
- **가능한 행동:**
  - 빠른 전환 공격 (즉시 공격 시도)
  - 안정적 재배치 (빌드업 Phase로)
  - 수비 재배치 (수비 Phase로)
- **전환 조건:**
  - 빠른 전환 공격 성공 → 파이널 서드 Phase
  - 안정적 재배치 → 빌드업 Phase
  - 수비 재배치 → 수비 Phase
- **전술 영향:**
  - 전환 속도: 빠른 전환 공격 확률 증가
  - 공격성: 빠른 전환 공격 선택 확률 증가

**5. 수비 (Defense) Phase**

- **의미:** 상대의 공격을 막는 Phase
- **발생 조건:**
  - 상대가 공격 Phase에 있을 때
  - 전환 Phase에서 수비 재배치 선택
- **가능한 행동:**
  - 압박 (상대 패스 방해)
  - 태클 (공 빼앗기)
  - 인터셉트 (패스 차단)
  - 수비 재배치 (포지셔닝)
- **전환 조건:**
  - 공 회수 성공 → 전환 Phase 또는 빌드업 Phase
  - 상대 골 → 골킥 (빌드업 Phase)
- **전술 영향:**
  - 압박 강도: 압박 행동 빈도 증가
  - 수비 라인: 포지셔닝 영향

**6. 세트피스 (Set Piece) Phase (선택적)**

- **의미:** 코너킥, 프리킥, 페널티킥 등
- **발생 조건:**
  - 특정 상황에서 발생 (예: 파울, 골라인 밖)
- **가능한 행동:**
  - 코너킥
  - 프리킥
  - 페널티킥
- **전환 조건:**
  - 세트피스 종료 → 일반 Phase
- **전술 영향:**
  - 공격성: 세트피스에서 공격적 선택 확률 증가

#### Phase 전환 확률 계산식

**예시: 빌드업 Phase → 중원 전개 Phase**

```
기본 전환 확률 = 0.3 (30%)

전술 보정:
- 짧은 패스 전술 (1-3): -10% ~ -5%
- 긴 패스 전술 (7-10): +5% ~ +10%

스탯 보정:
- 평균 PAS 스탯: (팀 평균 PAS - 5) × 2%
- 최대 ±10%

최종 전환 확률 = 기본 확률 + 전술 보정 + 스탯 보정
최종 전환 확률 범위: 0.15 ~ 0.50 (15% ~ 50%)
```

**Phase 전환 판정:**

```
랜덤 값 (0.0 ~ 1.0) < 최종 전환 확률 → Phase 전환
랜덤 값 >= 최종 전환 확률 → 현재 Phase 유지
```

---

## 5. 컨테스트(행동 판정) 계산 구조

### 5.1 행동 흐름

#### 전체 행동 판정 흐름

```
[의도 선택] → [대상 선정] → [컨테스트 계산] → [성공/실패 판정] → [상태 업데이트]
```

#### 각 단계 상세 설명

**1. 의도 선택 (Action Intent Selection)**

- **의미:** 현재 Phase에서 가능한 행동 중 하나를 선택
- **선택 방식:** 확률 기반 (전술과 상황에 따라 확률 가중)
- **예시:**
  - 중원 전개 Phase에서 가능한 행동:
    - 패스: 40%
    - 드리블: 30%
    - 전방 패스: 20%
    - 중거리 슈팅: 10%
  - 전술 보정:
    - 공격성 높음: 드리블 +10%, 슈팅 +5%
    - 공격성 낮음: 패스 +10%, 드리블 -10%

**2. 대상 선정 (Target Selection)**

- **의미:** 행동의 주체(공을 가진 선수)와 대상(패스 받을 선수, 태클 대상 등) 결정
- **선정 방식:**
  - 주체: 공을 가진 선수 (현재 볼 위치의 Zone에 있는 선수)
  - 대상: 가능한 대상 중 스탯과 위치를 고려하여 선택
  - 예: 패스 대상 = 같은 Phase의 선수 중 PAS 스탯이 높은 선수 우선

**3. 컨테스트 계산 (Contest Calculation)**

- **의미:** 행동 성공을 결정하는 점수 계산
- **계산 요소:**
  - 공격자 스탯 (행동을 시도하는 선수)
  - 수비자 스탯 (방어하는 선수, 있는 경우)
  - 전술 보정치
  - 상황 변수 (압박, 거리, 공간 등)
- **계산식:**
  ```
  공격자 점수 = (관련 스탯 × 포지션 가중치 × 전술 보정) + 상황 보정
  수비자 점수 = (관련 스탯 × 포지션 가중치 × 전술 보정) + 상황 보정
  
  컨테스트 점수 = 공격자 점수 - 수비자 점수
  ```

**4. 성공/실패 판정 (Success/Failure Judgment)**

- **의미:** 컨테스트 점수를 기반으로 성공 확률 계산 및 판정
- **확률 계산:**
  ```
  기본 성공 확률 = 0.5 (50%)
  
  컨테스트 점수 보정:
  - 점수 차이 × 3% (최대 ±30%)
  
  최종 성공 확률 = 기본 확률 + 점수 보정
  최종 성공 확률 범위: 0.2 ~ 0.8 (20% ~ 80%)
  ```
- **판정:**
  ```
  랜덤 값 (0.0 ~ 1.0) < 최종 성공 확률 → 성공
  랜덤 값 >= 최종 성공 확률 → 실패
  ```

**5. 상태 업데이트 (State Update)**

- **의미:** 판정 결과에 따라 게임 상태 업데이트
- **업데이트 항목:**
  - 볼 위치 (Zone)
  - 공을 가진 선수
  - 선수 위치 (Zone)
  - 체력 소모
  - Phase 전환 (필요 시)
  - 이벤트 로그 (중요 이벤트만)

### 5.2 계산 요소 명시

#### 컨테스트별 계산 요소

**1. 패스 컨테스트**

- **공격자 점수:**
  ```
  PAS 스탯 × 포지션 가중치 × 전술 보정 (패스 스타일)
  + 거리 페널티 (-거리 × 2%)
  + 압박 페널티 (-압박 강도 × 3%)
  ```
- **수비자 점수:**
  ```
  INT 스탯 × 포지션 가중치 × 전술 보정 (압박 강도)
  + 포지셔닝 보너스 (SPA 스탯 × 0.5)
  ```
- **성공 조건:** 공격자 점수 > 수비자 점수 → 성공 확률 계산

**2. 드리블 컨테스트**

- **공격자 점수:**
  ```
  DRI 스탯 × 포지션 가중치 × 전술 보정 (공격성)
  + SPA 스탯 × 0.3 (공간 활용)
  ```
- **수비자 점수:**
  ```
  TAC 스탯 × 포지션 가중치 × 전술 보정 (압박 강도)
  + SPA 스탯 × 0.5 (포지셔닝)
  ```
- **성공 조건:** 공격자 점수 > 수비자 점수 → 성공 확률 계산

**3. 슈팅 컨테스트**

- **슈팅 정확도 판정:**
  ```
  SHO 스탯 × 포지션 가중치 × 전술 보정 (공격성)
  + 거리 페널티 (-거리 × 5%)
  + 압박 페널티 (-압박 강도 × 4%)
  ```
- **골키퍼 방어 판정:**
  ```
  GK TAC 스탯 × 1.5 (골키퍼 가중치)
  + SPA 스탯 × 0.5 (포지셔닝)
  ```
- **골 확률:**
  ```
  슈팅 정확도 점수 > 골키퍼 방어 점수 → 골 확률 계산
  골 확률 = 기본 30% + (점수 차이 × 2%)
  골 확률 범위: 10% ~ 60%
  ```

**4. 태클 컨테스트**

- **수비자 점수:**
  ```
  TAC 스탯 × 포지션 가중치 × 전술 보정 (압박 강도)
  + SPA 스탯 × 0.3 (포지셔닝)
  ```
- **공격자 점수:**
  ```
  DRI 스탯 × 포지션 가중치
  + SPA 스탯 × 0.3 (회피)
  ```
- **성공 조건:** 수비자 점수 > 공격자 점수 → 태클 성공 (공 회수)

**5. 인터셉트 컨테스트**

- **수비자 점수:**
  ```
  INT 스탯 × 포지션 가중치 × 전술 보정 (압박 강도)
  + SPA 스탯 × 0.5 (예측 포지셔닝)
  ```
- **공격자 점수:**
  ```
  PAS 스탯 × 포지션 가중치 × 전술 보정 (패스 스타일)
  + 거리 페널티 (-거리 × 2%)
  ```
- **성공 조건:** 수비자 점수 > 공격자 점수 → 인터셉트 성공

#### 랜덤 요소의 위치와 한계

**랜덤 요소 사용 위치:**

1. **Phase 전환 판정**
   - 확률 기반 Phase 전환
   - 랜덤 값 < 전환 확률 → 전환

2. **행동 선택**
   - 가능한 행동 중 확률 가중으로 선택
   - 랜덤 값 기반 선택

3. **성공/실패 판정**
   - 컨테스트 점수 기반 확률로 판정
   - 랜덤 값 < 성공 확률 → 성공

**랜덤 요소의 한계:**

- **절대 랜덤 금지:** 모든 랜덤은 스탯/전술 기반 확률
- **확률 범위 제한:**
  - 최소 성공 확률: 20% (아무리 스탯이 낮아도 20% 확률)
  - 최대 성공 확률: 80% (아무리 스탯이 높아도 80% 확률)
  - 이는 축구의 불확실성을 반영

**랜덤 요소의 공정성:**

- 모든 랜덤은 시드 기반 (재현 가능)
- 같은 조건에서 같은 결과 (디버깅 가능)
- PvP에서는 양팀에 동일한 랜덤 시드 사용 (공정성)

---

## 6. 공간/필드 모델

### 6.1 Zone 기반 모델 설계

#### Zone 구조

축구장을 **Zone**으로 분할하여 공간을 표현합니다.

**Zone 분할 방식:**

- **가로 분할:** 3등분 (좌측, 중앙, 우측)
- **세로 분할:** 5등분 (후방, 후중앙, 중앙, 전중앙, 전방)
- **총 Zone 수:** 3 × 5 = 15개 Zone

**Zone 번호 체계:**

```
후방:     [1] [2] [3]
후중앙:   [4] [5] [6]
중앙:     [7] [8] [9]
전중앙:   [10][11][12]
전방:     [13][14][15]

[1]=좌측 후방, [2]=중앙 후방, [3]=우측 후방
...
[13]=좌측 전방, [14]=중앙 전방, [15]=우측 전방
```

#### Zone별 의미

| Zone 범위 | 의미 | 주요 활동 |
|----------|------|----------|
| **후방 (1-3)** | 수비 진영 | 빌드업, 수비 재배치 |
| **후중앙 (4-6)** | 수비와 중원 사이 | 빌드업, 전환 |
| **중앙 (7-9)** | 중원 | 중원 전개, 패스 |
| **전중앙 (10-12)** | 공격과 중원 사이 | 파이널 서드 진입 |
| **전방 (13-15)** | 공격 진영 | 슈팅, 최종 패스 |

#### 볼과 선수 위치 추적

**볼 위치:**

- 볼은 항상 하나의 Zone에 위치
- 볼 위치 = 현재 공을 가진 선수가 있는 Zone
- 패스 성공 시 볼 위치 = 대상 선수의 Zone으로 이동

**선수 위치:**

- 각 선수는 하나의 Zone에 위치
- 선수 위치는 Phase와 전술에 따라 결정
- 예: DF는 후방/후중앙 Zone에 주로 위치, FW는 전방 Zone에 주로 위치

**위치 업데이트:**

- 행동 성공/실패에 따라 위치 변경
- 예: 패스 성공 → 공을 받은 선수의 Zone으로 볼 이동
- 예: 드리블 성공 → 공격자가 전방 Zone으로 이동 가능

### 6.2 Zone 간 거리 및 이동

#### Zone 간 거리 계산

**거리 계산식:**

```
거리 = |Zone1의 세로 위치 - Zone2의 세로 위치| + |Zone1의 가로 위치 - Zone2의 가로 위치|
```

**예시:**

- Zone 2 (중앙 후방) → Zone 8 (중앙 중앙): 거리 = |1-3| + |2-2| = 2
- Zone 1 (좌측 후방) → Zone 15 (우측 전방): 거리 = |1-5| + |1-3| = 6

**거리 페널티:**

- 패스 거리가 멀수록 성공률 감소
- 거리 페널티 = -거리 × 2% (패스), -거리 × 5% (슈팅)

#### Zone 간 이동 규칙

**선수 이동:**

- 선수는 Phase와 행동에 따라 Zone 이동
- 예: 공격 Phase → 선수들이 전방 Zone으로 이동
- 예: 수비 Phase → 선수들이 후방 Zone으로 이동

**볼 이동:**

- 볼은 행동 성공 시 대상 Zone으로 이동
- 예: 패스 성공 → 볼이 대상 선수의 Zone으로 이동
- 예: 드리블 성공 → 볼이 공격자가 이동한 Zone으로 이동

---

## 7. 체력·모멘텀·후반 변화 설계

### 7.1 Stamina 감소 규칙

#### 체력 소모 계산

**기본 체력 소모량:**

| 행동 | 기본 소모량 |
|------|------------|
| 패스 | 0.5 |
| 드리블 | 1.5 |
| 슈팅 | 1.0 |
| 태클 | 2.0 |
| 인터셉트 | 1.5 |
| 대시 (전환 시) | 2.5 |

**전술 보정:**

- 압박 강도: 모든 행동 소모량 × (1 + (Pressing - 5) × 0.15)
- 공격성: 공격 행동 소모량 × (1 + (Attack - 5) × 0.1)
- 전환 속도: 전환 행동 소모량 × (1 + (TransitionSpeed - 5) × 0.1)

**스탯 보정:**

- STA 스탯이 높을수록 소모량 감소
- 소모량 × (1 - (STA - 5) × 0.05) (최소 0.7배)

#### 체력 상태

**체력 수준:**

- 최대 체력: 100
- 체력 수준별 상태:
  - 100-70: 정상 (페널티 없음)
  - 69-50: 약간 피로 (모든 스탯 -1)
  - 49-30: 피로 (모든 스탯 -2)
  - 29-10: 매우 피로 (모든 스탯 -3)
  - 9-0: 극도 피로 (모든 스탯 -4)

**체력 회복:**

- 경기 중 체력 회복 없음 (후반 시작 시 일부 회복)
- 후반 시작 시 체력 +20 (최대 100)

### 7.2 체력이 행동/판정에 주는 페널티

#### 체력 페널티 적용

**스탯 페널티:**

- 체력 수준에 따라 모든 스탯에 페널티 적용
- 예: 체력 40 → 모든 스탯 -2
- 페널티는 컨테스트 계산 전에 적용

**행동 빈도 페널티:**

- 체력이 낮을수록 고강도 행동 빈도 감소
- 예: 체력 30 이하 → 드리블 빈도 -20%, 태클 빈도 -15%

### 7.3 모멘텀 메커니즘

#### 모멘텀 계산

**모멘텀 점수:**

- 초기 모멘텀: 0
- 모멘텀 범위: -10 ~ +10

**모멘텀 변화:**

| 이벤트 | 모멘텀 변화 |
|--------|------------|
| 골 득점 | +3 |
| 골 실점 | -3 |
| 주요 기회 창출 | +1 |
| 주요 기회 놓침 | -1 |
| 실수 (패스 실패 등) | -0.5 |
| 연속 성공 행동 (3회 이상) | +0.5 |

**모멘텀 적용:**

- 모멘텀 점수에 따라 스탯 보정
- 보정치 = 모멘텀 점수 × 0.5% (최대 ±5%)
- 예: 모멘텀 +6 → 모든 스탯 +3%

### 7.4 후반 경기 양상 변화

#### 후반 변화 요소

**1. 체력 감소**

- 후반 시작 시 체력 +20 회복
- 하지만 전반보다 체력 소모가 빠름 (피로 누적)
- 후반 30분 이후 체력 페널티 증가

**2. 전술 변화**

- 유저가 실시간으로 전술 변경 가능
- 후반에 들어서 공격적으로 변경하거나 수비적으로 변경 가능
- 전술 변경은 다음 Phase부터 적용

**3. 모멘텀 효과 증가**

- 후반에는 모멘텀 효과가 더 크게 적용
- 모멘텀 보정치 = 모멘텀 점수 × 0.7% (전반 0.5%에서 증가)

**4. 결정적 순간**

- 후반 30분 이후 결정적 순간 발생 확률 증가
- 결정적 순간: 골 확률이 일시적으로 증가하는 상황
- 발생 확률 = 기본 5% + (공격성 - 5) × 1%

---

## 8. 경기 결과 및 리포트 시스템

### 8.1 이벤트 로그 설계

#### 기록되는 이벤트

**필수 기록 이벤트:**

1. **골**
   - 시간, 득점자, 어시스트 (있는 경우)
   - 골 상황 (슈팅, 헤딩, 페널티 등)
   - 관련 스탯 (SHO, SPA 등)

2. **주요 기회**
   - 슈팅 기회 (골대 안/밖)
   - 크로스 기회
   - 1대1 상황

3. **전환**
   - 공수 전환 발생
   - 전환 Phase에서의 행동

4. **Phase 전환**
   - Phase 변경 (빌드업 → 중원 전개 등)
   - 전환 원인 (패스 성공, 실패 등)

5. **주요 실수**
   - 패스 실패로 인한 전환
   - 태클 실패로 인한 기회 제공

**선택 기록 이벤트 (상세 모드):**

- 모든 패스 성공/실패
- 모든 드리블 시도
- 모든 태클 시도
- 체력 소모 상세

#### 이벤트 로그 구조

```python
EventLog = {
    "tick": int,           # 발생 시간 (Tick)
    "phase": str,          # 발생 Phase
    "event_type": str,     # 이벤트 타입 (골, 기회, 전환 등)
    "team": str,           # 관련 팀 (공격/수비)
    "player": int,         # 관련 선수 ID
    "action": str,         # 행동 (슈팅, 패스 등)
    "result": str,         # 결과 (성공/실패)
    "stats_used": dict,    # 사용된 스탯
    "tactics_impact": dict # 전술 영향
}
```

### 8.2 경기 리포트 시스템

#### 리포트 구성

**1. 경기 요약**

- 최종 스코어
- 득점자 및 시간
- 주요 통계 (슈팅 수, 패스 성공률 등)

**2. Phase별 분석**

- 각 Phase에서의 성공률
- Phase 전환 빈도
- Phase별 주요 이벤트

**3. 스탯 비교**

- 양팀의 평균 스탯 비교
- 포지션별 스탯 비교
- 주요 컨테스트에서의 스탯 비교

**4. 전술 분석**

- 양팀의 전술 설정 비교
- 전술 효과 분석
- 전술 변경 이력 (있는 경우)

**5. 주요 장면**

- 골 장면 상세 분석
- 주요 기회 장면
- 결정적 실수 장면

#### 리포트 문구 예시

**골 분석 예시:**

```
[45분] 골! 팀A의 공격수 #9가 골을 넣었습니다.

상황 분석:
- Phase: 파이널 서드
- 행동: 슈팅 (중앙 전방 Zone)
- 스탯: SHO 9, SPA 8
- 전술: 공격성 8, 전환 속도 9
- 골키퍼 방어: TAC 7, SPA 6

결과:
공격수의 높은 슈팅 정확도(SHO 9)와 공간 감각(SPA 8)이 
골키퍼의 수비 능력을 넘어서 골로 연결되었습니다.
공격적 전술(공격성 8)이 슈팅 기회를 증가시켰고,
빠른 전환 속도(9)가 상대 수비가 정비되기 전에 
기회를 만들어냈습니다.
```

**패배 분석 예시:**

```
팀B가 패배한 주요 원인:

1. 중원 전개 Phase 실패율 높음 (45%)
   - 평균 PAS 스탯: 6.2 (상대: 7.8)
   - 짧은 패스 전술(2)이 안정성을 높였지만,
     상대의 높은 압박(8)에 취약했습니다.

2. 파이널 서드 진입 빈도 낮음 (전반 3회)
   - 공격성(4)이 낮아 공격 기회가 부족했습니다.
   - 전환 속도(3)가 낮아 전환 기회를 활용하지 못했습니다.

3. 후반 체력 저하
   - 평균 STA 스탯: 5.5 (상대: 7.2)
   - 후반 30분 이후 스탯 페널티로 인해 
     모든 컨테스트에서 불리했습니다.

개선 제안:
- PAS 스탯 투자 증가 (현재 평균 6.2 → 목표 7.5)
- 공격성 전술 상향 (현재 4 → 목표 6-7)
- STA 스탯 투자 증가 (현재 평균 5.5 → 목표 7.0)
```

---

## 9. 데이터 구조 예시

### 9.1 기본 데이터 구조

#### PlayerState

```python
class PlayerState:
    player_id: int
    position: str  # "GK", "DF", "MF", "FW"
    zone: int  # 현재 Zone (1-15)
    
    # 스탯 (각 스탯은 1-10 범위)
    stats: {
        "PAS": int,  # 패스 정확도
        "DRI": int,  # 드리블 능력
        "SHO": int,  # 슈팅 정확도
        "SPA": int,  # 공간 감각
        "TAC": int,  # 태클 능력
        "INT": int,  # 인터셉트 능력
        "STA": int   # 체력
    }
    
    # 동적 상태
    stamina: float  # 현재 체력 (0-100)
    has_ball: bool  # 공을 가지고 있는지
    
    # 포지션 가중치 (계산된 값)
    position_weights: dict  # {"PAS": 1.2, "DRI": 1.1, ...}
```

#### TeamState

```python
class TeamState:
    team_id: str
    players: List[PlayerState]  # 11명의 선수
    
    # 전술 설정
    tactics: {
        "attack": int,           # 1-10
        "pass_style": int,       # 1-10
        "pressing": int,         # 1-10
        "defense_line": int,     # 1-10
        "transition_speed": int, # 1-10
        "width": int             # 1-10
    }
    
    # 경기 상태
    score: int
    momentum: int  # -10 ~ +10
    possession: float  # 점유율 (0.0-1.0)
    
    # 통계
    stats: {
        "shots": int,
        "shots_on_target": int,
        "passes_attempted": int,
        "passes_completed": int,
        "tackles_attempted": int,
        "tackles_successful": int
    }
```

#### MatchState

```python
class MatchState:
    match_id: str
    tick: int  # 현재 Tick (0-5400)
    half: int  # 전반(1) 또는 후반(2)
    
    # 양팀 상태
    home_team: TeamState
    away_team: TeamState
    
    # 현재 Phase
    current_phase: str  # "build_up", "midfield", "final_third", "transition", "defense"
    attacking_team: str  # 현재 공격 팀 ("home" 또는 "away")
    
    # 볼 상태
    ball_zone: int  # 볼이 있는 Zone (1-15)
    ball_holder: int  # 공을 가진 선수 ID
    
    # 이벤트 로그
    event_log: List[EventLog]
    
    # 경기 상태
    is_finished: bool
    winner: str  # "home", "away", "draw"
```

### 9.2 Resolver / Simulator 구조

#### ContestResolver

```python
class ContestResolver:
    """
    컨테스트(행동 판정)를 계산하는 클래스
    """
    
    def calculate_contest_score(
        self,
        attacker: PlayerState,
        defender: PlayerState,
        action_type: str,
        situation: dict
    ) -> float:
        """
        컨테스트 점수 계산
        
        Args:
            attacker: 공격자 (행동을 시도하는 선수)
            defender: 수비자 (방어하는 선수, None 가능)
            action_type: 행동 타입 ("pass", "dribble", "shoot", "tackle", "intercept")
            situation: 상황 변수 (압박, 거리, 공간 등)
        
        Returns:
            컨테스트 점수 (공격자 점수 - 수비자 점수)
        """
        # 공격자 점수 계산
        attacker_score = self._calculate_attacker_score(
            attacker, action_type, situation
        )
        
        # 수비자 점수 계산 (있는 경우)
        defender_score = 0.0
        if defender:
            defender_score = self._calculate_defender_score(
                defender, action_type, situation
            )
        
        return attacker_score - defender_score
    
    def _calculate_attacker_score(
        self,
        player: PlayerState,
        action_type: str,
        situation: dict
    ) -> float:
        """
        공격자 점수 계산
        """
        # 행동 타입에 따른 스탯 선택
        relevant_stats = self._get_relevant_stats(action_type)
        
        # 스탯 값 계산 (포지션 가중치 적용)
        stat_value = 0.0
        for stat_name in relevant_stats:
            base_stat = player.stats[stat_name]
            weight = player.position_weights[stat_name]
            stat_value += base_stat * weight
        
        # 전술 보정 적용
        tactics_bonus = self._calculate_tactics_bonus(
            action_type, player.team.tactics
        )
        
        # 상황 변수 보정
        situation_penalty = self._calculate_situation_penalty(situation)
        
        # 체력 페널티 적용
        stamina_penalty = self._calculate_stamina_penalty(player.stamina)
        
        # 최종 점수
        final_score = (
            stat_value * (1 + tactics_bonus) 
            - situation_penalty 
            - stamina_penalty
        )
        
        return final_score
    
    def resolve_contest(
        self,
        contest_score: float,
        random_value: float
    ) -> bool:
        """
        컨테스트 점수를 기반으로 성공/실패 판정
        
        Args:
            contest_score: 컨테스트 점수
            random_value: 랜덤 값 (0.0-1.0)
        
        Returns:
            True if success, False if failure
        """
        # 기본 성공 확률
        base_success_rate = 0.5
        
        # 점수 차이에 따른 보정 (±30% 최대)
        score_bonus = min(max(contest_score * 0.03, -0.3), 0.3)
        
        # 최종 성공 확률 (20%-80% 범위)
        success_rate = base_success_rate + score_bonus
        success_rate = min(max(success_rate, 0.2), 0.8)
        
        # 판정
        return random_value < success_rate
```

#### PhaseManager

```python
class PhaseManager:
    """
    Phase 전환을 관리하는 클래스
    """
    
    def determine_next_phase(
        self,
        current_phase: str,
        action_result: bool,
        match_state: MatchState
    ) -> str:
        """
        현재 Phase와 행동 결과를 기반으로 다음 Phase 결정
        
        Args:
            current_phase: 현재 Phase
            action_result: 행동 결과 (성공/실패)
            match_state: 현재 경기 상태
        
        Returns:
            다음 Phase
        """
        # Phase 전환 규칙에 따라 다음 Phase 결정
        transition_rules = self._get_transition_rules(current_phase)
        
        for rule in transition_rules:
            if self._check_condition(rule, action_result, match_state):
                return rule.next_phase
        
        # 조건에 맞는 규칙이 없으면 현재 Phase 유지
        return current_phase
    
    def _get_transition_rules(self, phase: str) -> List[TransitionRule]:
        """
        Phase별 전환 규칙 반환
        """
        rules = {
            "build_up": [
                TransitionRule(
                    condition=lambda r, s: r and s.action == "pass_to_midfield",
                    next_phase="midfield"
                ),
                TransitionRule(
                    condition=lambda r, s: not r,
                    next_phase="transition"
                )
            ],
            "midfield": [
                TransitionRule(
                    condition=lambda r, s: r and s.action == "pass_to_forward",
                    next_phase="final_third"
                ),
                TransitionRule(
                    condition=lambda r, s: not r,
                    next_phase="transition"
                )
            ],
            # ... 다른 Phase 규칙들
        }
        return rules.get(phase, [])
```

#### MatchSimulator

```python
class MatchSimulator:
    """
    경기 시뮬레이션을 실행하는 메인 클래스
    """
    
    def __init__(self):
        self.resolver = ContestResolver()
        self.phase_manager = PhaseManager()
        self.random_seed = None
    
    def simulate_match(
        self,
        home_team: TeamState,
        away_team: TeamState,
        random_seed: int = None
    ) -> MatchState:
        """
        경기 시뮬레이션 실행
        
        Args:
            home_team: 홈 팀 상태
            away_team: 원정 팀 상태
            random_seed: 랜덤 시드 (재현 가능성)
        
        Returns:
            시뮬레이션 완료된 MatchState
        """
        # 초기 상태 설정
        match_state = MatchState(
            home_team=home_team,
            away_team=away_team,
            tick=0,
            half=1,
            current_phase="build_up",
            attacking_team="home",
            ball_zone=2,  # 중앙 후방
            ball_holder=home_team.players[0].player_id
        )
        
        # 랜덤 시드 설정
        if random_seed:
            random.seed(random_seed)
        
        # Tick 단위 시뮬레이션
        for tick in range(5400):  # 90분 = 5400초
            match_state.tick = tick
            
            # 전반/후반 구분
            if tick == 2700:  # 전반 종료
                match_state.half = 2
                self._apply_half_time_rest(match_state)
            
            # Phase 판정 및 전환
            self._process_phase(match_state)
            
            # 행동 선택 및 실행
            self._process_action(match_state)
            
            # 상태 업데이트
            self._update_state(match_state)
            
            # 경기 종료 조건 확인
            if self._check_match_end(match_state):
                break
        
        # 경기 종료 처리
        match_state.is_finished = True
        match_state.winner = self._determine_winner(match_state)
        
        return match_state
    
    def _process_phase(self, match_state: MatchState):
        """
        Phase 처리 및 전환 판정
        """
        current_phase = match_state.current_phase
        attacking_team = match_state.attacking_team
        
        # Phase 전환 확률 계산
        transition_prob = self._calculate_transition_probability(
            current_phase, attacking_team, match_state
        )
        
        # 전환 판정
        if random.random() < transition_prob:
            next_phase = self.phase_manager.determine_next_phase(
                current_phase, True, match_state
            )
            match_state.current_phase = next_phase
    
    def _process_action(self, match_state: MatchState):
        """
        행동 선택 및 실행
        """
        # 현재 Phase에서 가능한 행동 선택
        action = self._select_action(match_state)
        
        # 행동의 주체와 대상 선정
        attacker, defender = self._select_players(action, match_state)
        
        # 컨테스트 계산
        contest_score = self.resolver.calculate_contest_score(
            attacker, defender, action.type, action.situation
        )
        
        # 성공/실패 판정
        random_value = random.random()
        success = self.resolver.resolve_contest(contest_score, random_value)
        
        # 결과에 따른 상태 업데이트
        self._apply_action_result(action, success, match_state)
        
        # 이벤트 로그 기록 (중요 이벤트만)
        if self._is_important_event(action, success):
            self._log_event(action, success, match_state)
```

---

## 10. MVP 범위 정의

### 10.1 1차 MVP 필수 구현 항목

#### 핵심 기능

**1. 팀 생성 및 스탯 분배**
- 11명의 선수 생성
- 포지션 할당 (GK 1명, DF 4명, MF 4명, FW 2명 - 기본 구성)
- 100 포인트 스탯 분배 시스템
- 스탯 분배 유효성 검증 (최소 1 포인트, 총합 100 포인트)

**2. 전술 설정**
- 6개 전술 파라미터 설정 (공격성, 패스 스타일, 압박 강도, 수비 라인, 전환 속도, 폭)
- 전술 값 범위 검증 (1-10)
- 전술 저장 및 불러오기

**3. 기본 시뮬레이션 엔진**
- Tick 기반 시뮬레이션 (5400 Tick = 90분)
- 5개 Phase 구현 (빌드업, 중원 전개, 파이널 서드, 전환, 수비)
- Phase 전환 로직
- 기본 행동 구현 (패스, 드리블, 슈팅, 태클, 인터셉트)

**4. 컨테스트 시스템**
- 7개 스탯 기반 컨테스트 계산
- 포지션 가중치 적용
- 전술 보정치 적용
- 확률 기반 성공/실패 판정

**5. Zone 기반 필드 모델**
- 15개 Zone 구조 (3×5)
- 볼 위치 추적
- 선수 위치 추적 (기본 위치만, 상세 이동은 제외)

**6. 기본 체력 시스템**
- 체력 소모 계산
- 체력 페널티 적용 (기본만, 상세 구간별 페널티는 제외)
- 후반 시작 시 체력 회복

**7. 경기 결과 및 기본 리포트**
- 최종 스코어 계산
- 골 이벤트 기록
- 기본 통계 (슈팅 수, 패스 성공률 등)
- 간단한 리포트 생성

**8. 매칭 시스템**
- 기본 매칭 (랜덤 매칭)
- 경기 시작 및 종료 처리

#### 데이터 구조

- PlayerState, TeamState, MatchState 기본 구조
- ContestResolver 기본 구현
- PhaseManager 기본 구현
- MatchSimulator 기본 구현

### 10.2 의도적으로 제외하는 요소

**1. 세트피스 (Set Piece)**
- 코너킥, 프리킥, 페널티킥 제외
- MVP 이후 추가 예정

**2. 상세한 모멘텀 시스템**
- 기본 모멘텀 계산만 구현 (골 득실점 기반)
- 상세한 모멘텀 효과는 제외

**3. 실시간 전술 변경**
- 경기 중 전술 변경 기능 제외
- MVP에서는 경기 전에만 전술 설정 가능

**4. 상세한 이벤트 로그**
- 모든 행동 기록 제외
- 골, 주요 기회만 기록

**5. 역할(Role) 시스템**
- 기본 포지션만 사용 (GK, DF, MF, FW)
- 역할 세분화 제외

**6. 레벨/랭크 시스템**
- 기본 매칭만 구현
- 레벨/랭크 기반 매칭 제외

**7. 상세한 리포트 분석**
- 기본 리포트만 제공
- 상세 분석 및 개선 제안 제외

### 10.3 이후 확장 가능한 방향

**1. 게임플레이 확장**
- 세트피스 추가 (코너킥, 프리킥, 페널티킥)
- 역할(Role) 시스템 추가
- 실시간 전술 변경 기능
- 교체 선수 시스템 (벤치 선수)

**2. 시뮬레이션 고도화**
- 더 상세한 Zone 모델 (더 많은 Zone 또는 하위 Zone)
- 선수 개별 이동 경로 추적
- 더 복잡한 전술 조합
- 날씨, 경기장 조건 등 외부 요인

**3. 메타게임 확장**
- 레벨/랭크 시스템
- 시즌 및 리그 시스템
- 토너먼트 모드
- 팀 커스터마이징 (팀명, 유니폼 등)

**4. 분석 및 학습**
- 상세한 경기 분석 리포트
- 전술 추천 시스템
- 스탯 분배 최적화 도구
- 경기 리플레이 기능

**5. 소셜 기능**
- 친구 시스템
- 팀 공유 및 평가
- 커뮤니티 전술 공유
- 리더보드

**6. 밸런스 및 밸런싱**
- 밸런스 패치 시스템
- 메타 분석 도구
- A/B 테스트를 통한 전술 효과 검증

---

## 부록: 계산식 요약

### 컨테스트 점수 계산

```
공격자 점수 = Σ(스탯 × 포지션 가중치) × (1 + 전술 보정) - 상황 페널티 - 체력 페널티
수비자 점수 = Σ(스탯 × 포지션 가중치) × (1 + 전술 보정) + 상황 보너스

컨테스트 점수 = 공격자 점수 - 수비자 점수
```

### 성공 확률 계산

```
기본 성공 확률 = 0.5 (50%)
점수 보정 = 컨테스트 점수 × 3% (최대 ±30%)
최종 성공 확률 = 기본 확률 + 점수 보정
최종 성공 확률 범위: 0.2 ~ 0.8 (20% ~ 80%)
```

### Phase 전환 확률 계산

```
기본 전환 확률 = Phase별 기본값 (예: 0.3)
전술 보정 = 전술 값에 따른 보정 (±10%)
스탯 보정 = 관련 스탯 평균에 따른 보정 (±10%)
최종 전환 확률 = 기본 확률 + 전술 보정 + 스탯 보정
```

### 체력 소모 계산

```
기본 소모량 = 행동별 기본값
전술 보정 = 전술 값에 따른 소모량 증가/감소
스탯 보정 = STA 스탯에 따른 소모량 감소
최종 소모량 = 기본 소모량 × (1 + 전술 보정) × (1 - 스탯 보정)
```

---

**문서 버전:** 1.0  
**작성일:** 2024  
**최종 수정일:** 2024
